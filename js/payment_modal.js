var formContainer=document.getElementById("payment-form-inner-container");if(formContainer){var modalContainer=document.getElementById("donation-content-container"),loadingContainer=document.getElementById("loading-container"),successContainer=document.getElementById("success-container"),errorContainer=document.getElementById("error-container"),canceledContainer=document.getElementById("canceled-container"),canceledContainerMessage=document.getElementById("canceled-container-message"),closeBtn=document.getElementById("donation-modal-close-btn"),oneTimeAmountField=document.getElementById("one-time-donation-amount"),stripeKey=formContainer.dataset.key,lang=formContainer.dataset.lang,label=formContainer.dataset.label,genericCancelMessage=formContainer.dataset.genericCancelMessage,successPageUrl=formContainer.dataset.successPageUrl,formEnv=formContainer.dataset.env,initialAmount=parseInt(oneTimeAmountField.value)*100,stripe=Stripe(stripeKey);const c={mode:"payment",amount:initialAmount,currency:"usd",loader:"always"};var elements=stripe.elements(c);const t=elements.create("expressCheckout",{buttonType:{googlePay:"donate",applePay:"donate"},buttonTheme:{googlePay:"black",applePay:"black"},paymentMethods:{applePay:"always",googlePay:"always",link:"never"}});t.mount("#express-checkout-element"),t.on("click",e=>{modalContainer.classList.add("is-hidden"),successContainer.classList.add("is-hidden"),errorContainer.classList.add("is-hidden"),canceledContainer.classList.add("is-hidden"),closeBtn.classList.add("is-hidden"),loadingContainer.classList.remove("is-hidden");var s=parseInt(oneTimeAmountField.value)*100;const i={emailRequired:!0,lineItems:[{name:label,amount:s}]};elements.update({amount:s}),e.resolve(i)});const a=function(e="stripe_express_checkout_failure"){modalContainer.classList.add("is-hidden"),loadingContainer.classList.add("is-hidden"),successContainer.classList.add("is-hidden"),canceledContainer.classList.add("is-hidden"),errorContainer.classList.remove("is-hidden"),closeBtn.classList.remove("is-hidden"),window.trackEvent(e)},o=function(){modalContainer.classList.add("is-hidden"),loadingContainer.classList.add("is-hidden"),successContainer.classList.add("is-hidden"),errorContainer.classList.add("is-hidden"),canceledContainerMessage.innerText=genericCancelMessage,canceledContainer.classList.remove("is-hidden"),closeBtn.classList.remove("is-hidden"),window.trackEvent("stripe_express_checkout_cancel")};t.on("cancel",e=>{console.error("[expressCheckoutElement.cancel] Error",{error:e}),o()}),t.on("confirm",async e=>{const{error:s}=await elements.submit();if(s){console.error("[expressCheckoutElement.submit] Error",{error:s}),a();return}console.log("expressCheckoutElement.confirm:",e);var i=parseInt(oneTimeAmountField.value)*100;let n;e.billingDetails&&e.billingDetails.email&&(n=e.billingDetails.email);const l=await fetch("https://web-production-9b27.up.railway.app/payments/intent",{method:"POST",body:JSON.stringify({amount:i,email:n,description:label,lang,env:formEnv}),headers:{"content-type":"application/json"}}),{secret:d}=await l.json();if(!d){a("stripe_express_checkout_failure_no_secret");return}const{error:u}=await stripe.confirmPayment({elements,clientSecret:d,confirmParams:{return_url:successPageUrl},redirect:"if_required"});u?a("stripe_express_checkout_failure_confirm_payment"):(modalContainer.classList.add("is-hidden"),loadingContainer.classList.add("is-hidden"),errorContainer.classList.add("is-hidden"),canceledContainer.classList.add("is-hidden"),successContainer.classList.remove("is-hidden"),closeBtn.classList.remove("is-hidden"),window.trackEvent("stripe_express_checkout_success"))});const r=document.getElementById("express-checkout-element");t.on("ready",function(e){!e||!e.availablePaymentMethods?(formContainer.classList.add("is-hidden"),document.getElementById("payment-divider-for-one-time-donation").classList.add("is-hidden")):r.style.visibility="initial"}),oneTimeAmountField.onchange=function(){if(!(!athMovilLoaded||!ATHM_Checkout||!ATHM_Checkout.publicToken)){var e=parseFloat(this.value).toFixed(2);(!e||isNaN(e))&&(e=1),ATHM_Checkout.total=e,ATHM_Checkout.subtotal=e,ATHM_Checkout.items[0].price=e}},oneTimeAmountField.onblur=function(){if(!(!athMovilLoaded||!ATHM_Checkout||!ATHM_Checkout.publicToken)){var e=parseFloat(this.value);e?this.value=e.toFixed(2):this.value=1}}}
